# CentOS7权限

### 用户

作为多用户、多任务（Multi-Users，Multi-tasks）的服务器操作系统，Linux提供了严格的权限管理机制，主要从用户身份、文件权限两个方面对资源进行限制。Linux基于用户身份对资源访问进行控制。

**用户账号分类：**

- 超级用户：root，uid为0，权限最高，用来管理其他用户；
- 程序（系统）用户：uid（User IDentity：用户标识号）为1~999；
- 普通（登录）用户：uid为1000~60000；

**用户组：**

- 管理员组：root，gid（Group IDentity：组标识号）为0；
- 普通组：gid范围：1-65535，分为系统组和登录组；
  - 系统组：（gid范围：1-999）；
  - 登录组：（gid范围：6000-10000）；

组账号——用户的集合（其实可以认为是用户权限的集合）：

1. 基本组（私有组）——伴随着用户创建而创建 与用户同名（也可以自己设置） 但创建一个用户的时候必有其组；
2. 附加组（公有组）——直接创建空组，可以添加已有的用户，给组设置权限，该组中所有用户都具备此权限；

#### 用户账号文件

**/etc/passwd ：保存用户名称、宿主目录、登录shell等基本信息；**

```
# head -2 /etc/passwd     // 查看头两行信息
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
```

- root：用户账号名称；
- x：使用加密算法加密的密码，这里用x占位；
- 0：用户UID号；
- 0：所属基本组账号的UID；
- root：用户全名，可以填写用户详细信息；
- /root：宿主目录
- /bin/bash：指定用户的登录Shell

**/etc/shadow：保存用户的密码、账号有效等信息；**

```
# head -2 /etc/shadow
root:$6$n0xaRHlzyfLB7sO6$yjdtfvXbx38W.dUkBTmor93U8G2eMMIWo.xTLisv2IFN3nuE9eXEnDo2U3mm.atlVoNCnAQ7Z6ZBuqkZ5kUgp1::0:99999:7:::  // 以冒号分隔
bin:*:17110:0:99999:7:::
```

- root：用户账号名称；
- `$6$n0xaRHlzyfLB7sO6$yjdtfvXbx38W.dUkBTmor93U8G2eMMIWo.xTLisv2IFN3nuE9eXEnDo2U3mm.atlVoNCnAQ7Z6ZBuqkZ5kUgp1`：表示加密算法加密的密码，登录输入该密码是无效的；
  - 6：表示加密算法为sha512
  - n0xaRHlzyfLB7sO6：加密用的盐
- `：：`：之间的内容是上次修改时间；
- 0：密码的最短有效天数（0表示随时可以更改）；
- 99999：密码的最长有效天数；
- 7：提前7天提醒用户口令将过期；
- `：：：`：表示的是密码和账号过期之后的操作处理（基本可以忽略）

#### 用户即用户组的创建

 一个用户从创建到使用，通常经过的流程为：
     创建用户组——用户组密码——创建用户——设定密码。
     翻译成命令，即：
     groupadd——gpasswd——useradd——passwd。

**添加用户账号：**useradd命令

- -u ：指定用户的UID号，且该UID号没有被其他用户使用；
- -d ：指定用户的宿主目录位置（与-M一起使用时不生效！）
- -e ：账号失效时间（过期时间）
- -g ：基本组
- -G ：附加组
- -M ：不创家目录
- -s ：指定用户的登录shell

**设置/更改用户口令（密码）：**passwd命令

- -d  ：清除密码
- -l  ：锁定
- -S ：查看是否锁还是未锁（大写！！！）
- -u ：解锁

**修改用户账号的属性：**usermod命令

- -u ：修改用户的UID号
- -d ：修改用户的宿主目录位置
- -e ：修改用户账户失效时间
- -s ：指定用户的登录shell
- -l  ：更改用户登录账号名称
- -L ：锁定 ----- 相当于passwd -l
- -U ：解锁 ----- 相当于passwd -u 

**删除用户账号：**userdel命令

- -r：宿主目录一起删除

**用户账号的初始配置文件：**

文件来源——新建用户账号是从/etc/skel目录中复制过来 （cd到家目录中用ls -a）

1. ~/.bash_profile：表示进入bash后被加载
2. ~/.bashrc ：用户登录时被加载
3. ~/.bash_logout： 注销的时候执行

#### 管理组账号

**组账号文件：**与用户账号文件类似

1. /etc/group：保存组账号基本信息
2. /etc/shadow：保存组账号的密码信息（一般不会设置）

**添加组账号：**groupadd命令  -g 指定GID

**添加组成员：**gpasswd命令

1. -a ：向组中添加一个用户 a不会覆盖
2. -d ：从组中删除一个用户
3. -M ：**逗号分隔设置组的成员列表，会覆盖组成员，将原有的给踢出**

**删除组账号：**groupdel 组账号

- 不能使用 groupdel 命令随意删除组。此命令仅适用于删除那些 "不是任何用户初始组（主组 ）" 的组，换句话说，如果有组还是某用户的初始组（主组），则无法使用 groupdel 命令成功删除。
- 如果真的要删除，可以将创建该组的初始成员删除后再删除。

**查看最近的登录信息：**lastb命令

### 文件/目录的权限及归属

#### 访问权限

- 读取r：允许查看文件内容、显示目录列表
- 写入w：允许修改文件内容，允许在目录中新建、移动、删除文件或子目录
- 可执行x： 允许运行程序、切换目录

#### 归属

- 属主：用于该文件或目录的用户账号

- 属组：用于该文件或目录的组账号

#### 查看权限

**ls -l**：查看权限

```
# ls -l
总用量 20
lrwxrwxrwx.   1 root root    7 4月  13 07:29 bin -> usr/bin
dr-xr-xr-x.   5 root root 4096 4月  13 07:43 boot
```

以`dr-xr-xr-x.   5 root root 4096 4月  13 07:43 boot`为例，说明：

- d：文件类型
  - d：目录
  - l：连接文件
  - c：字符设备（输入输出文件）
  - b：设备（存储）文件
  - `-`：普通文件
- `-xr、-xr、-x.`：分别代表是属主权限（这里表示可读可执行）、属组权限（这里表示可读可执行）、other权限（这里表示可执行）
- 5：子目录数
- 第一个root：属主
- 第二个root：属组
- 4096：大小
- 4月  13 07:43：创建时间
- boot：目录名（文件名）

**设置文件和目录的权限：**chmod命令

1. chmod [ugoa] [+-=] [rwx]
   - u：属主
   - g：属组
   - o：other
   - a：全部
   - =+-：等于、增加、移除
2. chmod nnn 文件或目录（优先选择）
3. `ll`：是ls -a --color的别名

**设置文件和目录的归属：**chown命令

- chown 属主
- chown ：属组
- chown 属主：属组

**权限掩码：**umask命令

作用：控制新建的文件或目录的权限（只对新建的有效）

### 参考文献

* [Linux/Centos7账号与权限管理](https://blog.51cto.com/14557673/2446952?source=dra)
* [Centos7用户基本权限轻松管理篇](https://blog.csdn.net/learner198461/article/details/79714911)